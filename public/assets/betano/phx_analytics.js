(()=>{"use strict";function r(r,e,t){try{if(document){var a=document.createElement("img"),n="https://adlog.bangms.net/remotelog/get?".concat(r,"&action=").concat(e,"&msg=").concat(t,"&landUrl=").concat(window.location.href);a.src=n,a.onload=function(){a=null},a.onerror=function(){a=null}}}catch(r){i("sendReport error",r)}}function e(t,a,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;try{if(document){var c=document.createElement("img");c.src=t,c.onload=function(){r(t.split("?")[1],"report-success","image-request-success_report-success"),"function"==typeof a&&a(t),c=null},c.onerror=function(){r(t.split("?")[1],"report-failed","image-request-failed"),o>1?e(t,a,n,--o):("function"==typeof n&&n(t),c=null)}}}catch(e){i("sendReport error",e),r(t.split("?")[1],"report-failed","image-request-failed")}}var t="phx_ad_deep_param",a="phx_click_id",n="PXH_AD_DEEP_EVENT",o=function(r,e){try{var t=new URLSearchParams(r),a=decodeURIComponent(t.get(e));if(a&&"null"!==a){var n=function(r){var e=new URL(r),t={};return e.search.slice(1).split("&").forEach((function(r){var e=r.split("=");t[e[0]]=decodeURIComponent(e[1])})),t}(new URL("http://test.com?".concat(a)).href),o=n.event_report_url||"".concat(location.protocol,"//adwh.mywkd.com/thirdparty");return delete n.event_report_url,{param:n,callbackUrl:o}}return}catch(r){return void i("parsePhxAdParamFromSearch error",r)}},c=function(r){try{var e=o(window.location.search,r);if(e)return localStorage.setItem(t,JSON.stringify(e)),e;var a=window.location.hash,n=a.slice(a.indexOf("?")),c=o(n,r);if(c)return localStorage.setItem(t,JSON.stringify(c)),c}catch(r){return i("getPhxAdCallbackParamFromUrl error",r),!1}},l=-1!==window.location.href.indexOf("phxDebug"),i=function(){if(l){var r=Array.from(arguments);r.unshift("[PhxAnalytics]"),console.log.apply(window,r)}};function s(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.push.apply(t,a)}return t}function u(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?s(Object(t),!0).forEach((function(e){h(r,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))}))}return r}function p(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=r[t];return a}function f(r,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,a.key,a)}}function h(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var m={event_name:{},event_num:{},event_time:{}},d="PHX_DEEP_EVENT_STORE",y=new(function(){function o(){!function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),h(this,"callbackUrl",""),h(this,"callParams",null),this.parseTransparentParam(),this.handleAlreadyPushReport(),this.loopStorageAndReport()}var l,s;return l=o,s=[{key:"handleAlreadyPushReport",value:function(){var r=this;try{if(this.callbackUrl&&this.callParams&&window.phxAnalytics&&window.phxAnalytics.data&&window.phxAnalytics.data.length){var e=[];try{e=JSON.parse(localStorage.getItem(d))||[]}catch(r){i("handleAlreadyPushReport parse error",r)}window.phxAnalytics.data.forEach((function(t){var a,n,o=(a=Array.from(t),n=1,function(r){if(Array.isArray(r))return r}(a)||function(r,e){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var a,n,o=[],c=!0,l=!1;try{for(t=t.call(r);!(c=(a=t.next()).done)&&(o.push(a.value),!e||o.length!==e);c=!0);}catch(r){l=!0,n=r}finally{try{c||null==t.return||t.return()}finally{if(l)throw n}}return o}}(a,n)||function(r,e){if(r){if("string"==typeof r)return p(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?p(r,e):void 0}}(a,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],c=void 0===o?{}:o;c.event_time=Math.floor(Date.now()/1e3),e.unshift({props:c,callParams:r.callParams,callbackUrl:r.callbackUrl})})),localStorage.setItem(d,JSON.stringify(e))}}catch(r){i("handleAlreadyPushReport error",r)}}},{key:"parseTransparentParam",value:function(){var r=function(){try{var r=window.location,e=r.search,o=r.hash,l=r.href,s=e.includes(a),u=o.includes(a),p={};if(e.includes(n)||o.includes(n))return c(n)||{};if(!s&&!u)return i("getPhxEventCallbackParamFromUrl error, url has't exist phx_click_id param, current url is: ",l),p;if(p=function(r){try{var e=new URLSearchParams(r),t=decodeURIComponent(e.get(a));return t&&"null"!==t&&" "!==t&&"undefined"!==t?{param:{phx_click_id:t},callbackUrl:"".concat(location.protocol,"//adwh.mywkd.com/thirdparty")}:(i("[getPhxReportParamFromSearch] phx_click_id is ",t),null)}catch(r){return i("[getPhxReportParamFromSearch] error",r),null}}(s?e:o.slice(o.indexOf("?"))),p)return localStorage.setItem(t,JSON.stringify(p)),p}catch(r){return i("getPhxEventCallbackParamFromUrl error",r),!1}}(),e=r.callbackUrl,o=r.param;if(!o){var l=function(){try{return JSON.parse(localStorage.getItem(t))}catch(r){return null}}();l&&(e=l.callbackUrl,o=l.param)}i("getPhxEventCallbackParamFromUrl",e,o),this.callbackUrl=e,this.callParams=o}},{key:"report",value:function(t){var a=t.props,o=t.callback,c=t.callbackUrl,l=t.callParams,s=a.eventName,p=a.eventNum,f=a.EventName,h=a.EventNum,d=a.actionName,y=a.actionNum,v=a.ActionName,g=a.ActionNum;try{var b=o||{},P=b.onload,w=void 0===P?function(){}:P,S=b.onerror,k=void 0===S?function(){}:S;if(c){var O=d||v||s||f,_=y||g||p||h,U=function(r,e){try{return Object.keys(e).forEach((function(t){m[t]&&(r[t]=e[t])})),Object.keys(r).forEach((function(t){m[t]&&(e[t]||delete r[t])})),r}catch(r){return i("replaceCallbackParam err"),{}}}(u({},l),{event_name:O,event_num:_});U.event_time=a.event_time||Math.floor(Date.now()/1e3),U.sdk_version="1.0.2",i("valiableParam",U),e("".concat(c,"?").concat(function(e){var t=[],a=window.location,o=a.search,c=a.hash,l=o.includes(n)||c.includes(n),i=["t=".concat(+Date.now()),"report_type=2","type=".concat(l?"oldReport":"newReport")];try{return Object.keys(e).forEach((function(r){t.push("".concat(r,"=").concat(encodeURIComponent(e[r])))})),t.concat(i).join("&")}catch(e){console.warn("[parseUrlQuery] parse url query failed"),r(t.concat(i).join("&"),"report-failed","parse-query-failed_report-failed")}}(U)),w,k)}}catch(e){console.warn("[PhxAnalytics] deep param not exist"),r("","report-failed","deep-param-not-exist_report-failed")}}},{key:"push2Storage",value:function(r){var e=r.props,t=r.callbackUrl,a=r.callParams;try{var n=JSON.parse(localStorage.getItem(d))||[];n.push({props:e,callbackUrl:t,callParams:a}),i("push2Storage push"),localStorage.setItem(d,JSON.stringify(n))}catch(r){i("push2Storage catch"),localStorage.setItem(d,JSON.stringify([{props:e,callbackUrl:t,callParams:a}]))}}},{key:"popReadyPointFromStorage",value:function(){try{var r=JSON.parse(localStorage.getItem(d))||[],e=r.shift();return localStorage.setItem(d,JSON.stringify(r)),e}catch(r){return localStorage.setItem(d,[]),null}}},{key:"push",value:function(r){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.callbackUrl&&r){r.event_time=Math.floor(Date.now()/1e3);var a=u(u({},t),{},{onerror:function(a){"function"==typeof t.onerror&&t.onerror(a),i("push2Storage onerror"),e.push2Storage({props:r,callbackUrl:e.callbackUrl,callParams:e.callParams})}});this.report({props:r,callback:a,callbackUrl:this.callbackUrl,callParams:this.callParams})}}},{key:"loopStorageAndReport",value:function(){var r=this,e=this;setInterval((function(){try{var t=r.popReadyPointFromStorage();t&&e.report(u(u({},t),{},{callback:{onerror:function(){e.push2Storage(t)}}}))}catch(r){i("loopStorageAndReport err",r)}}),1e3)}}],s&&f(l.prototype,s),Object.defineProperty(l,"prototype",{writable:!1}),o}());window.phxAnalytics={deepUrlReport:function(){y.push.apply(y,arguments)}}})();